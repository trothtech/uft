#!/bin/sh
# © Copyright 1997, Richard M. Troth, all rights reserved.   <plaintext>
#
#         Name: configure (shell script)
#               set-up 'sendfile' (UFT) source directory for [re]making
#       Author: Rick Troth, Houston, Texas, USA
#         Date: 1997-Feb-02
#
#               We do not use automake and autoconf
#               for a couple of reasons.   One is that I am lazy
#               and have not learned *how* to use them.   But also,
#               that method is more complicated than we need here.
#

Z=`basename $0`

CFLAGS=""
#CFLAGS="-DOECS"
LDFLAGS=""
LIBS=""
PREFIX=/usr/local

UNAME=`uname`
echo "$Z: setting up 'sendfile' for $UNAME ..."

while [ "$1" != "" ] ; do
        case "$1" in
                --prefix=*|--prefi=*|--pref=*)
                        PREFIX=`echo "$1" | awk -F'=' '{print $2}'`
                        ;;
                -*)
                        echo "$0: unrecognized option '$1'"
                        exit 24
                        ;;
                *)
                        echo "$0: unrecognized argument '$1'"
                        exit 24
                        ;;
                esac
        shift
        done

if [ "$UNAME" = "VM/ESA" -o "$UNAME" = "z/VM" ]; then
        CFLAGS="-DOECS -D_OE_SOCKETS"
        LIBS="-l//posxsock -l//vmmtlib"
        fi
if [ "$UNAME" = "OS/390" -o "$UNAME" = "z/OS" ]; then
        CFLAGS="-DOECS -D_OE_SOCKETS"
        fi
if [ "$UNAME" = "SunOS" ]; then
        LIBS="-lsocket -lnsl"
        fi

#
# silently move old makefile aside:
mv makefile makefile.old 2>/dev/null

#
# start a fresh "makefile" and stamp it:
echo "# this file generated by '$0'" > makefile
date +'# %Y-%b-%d %T %Z %a' >> makefile

rm -f .sed
echo "s#%LDFLAGS%#$LDFLAGS#g" >> .sed
echo "s#%LIBS%#$LIBS#g" >> .sed
echo "s#%CFLAGS%#$CFLAGS#g" >> .sed
echo "s#%PREFIX%#$PREFIX#g" >> .sed
grep -v "^#" < makefile.in > makefile.tmp
RC=$? ; if [ $RC -ne 0 ] ; then exit $RC ; fi
sed -f .sed < makefile.tmp >> makefile
RC=$? ; if [ $RC -ne 0 ] ; then exit $RC ; fi
rm .sed makefile.tmp

#make clean 1>/dev/null 2>/dev/null

echo "$Z: done."

exit


echo "s#%LDFLAGS%#$LDFLAGS#g"
echo "s#%LIBS%#$LIBS#g"
echo "s#%CFLAGS%#$CFLAGS#g"
echo "s#%PREFIX%#$PREFIX#g"


